{
  "comments_id": "44562036",
  "rank": 4,
  "title": "Embedding user-defined indexes in Apache Parquet",
  "link": "https://datafusion.apache.org/blog/2025/07/14/user-defined-parquet-indexes/",
  "created_date": "2025-07-14T20:14:11.888899",
  "comments_summary": "[DataFusionにおけるParquetファイルへのカスタムメタデータの追加に関する議論]\n\n## Parquetの拡張性\n*   Parquetファイル形式は古くなってきており、新しい種類のメタデータでParquetを拡張する標準化された方法がないという批判がある。\n*   DataFusionは、既存のリーダーとの下位互換性を損なわずにこれを行うための巧妙な方法を示した。\n*   DataFusionは、他のリーダーが無視するfooterとデータページの間​​に任意のデータを挿入する。\n*   DataFusionのようなクエリエンジンはそれを活用できる。\n\n## DataFusionの実装\n*   DataFusionは、.parquetファイルに新しいインデックスを埋め込み、それを使用してクエリのパフォーマンスを向上させる。\n*   この特定のインスタンスでは、列のすべての異なる値を持つインデックスを追加する。\n*   次に、DataFusionクエリエンジンを拡張してそれを活用し、`WHERE nation = 'Singapore'`のようなクエリが、データページをスキャンせずにその値が.parquetファイルに存在するかどうかを判断できるようにする。\n*   データページのスキャンは、データセット全体のスキャンを回避するための最小-最大フィルターがあるため、すでに最適化されている。\n\n## 標準化の可能性\n*   この手法はDataFusionに固有のものではない。\n*   各エンジンは、インデックスを利用するためにそれらについて知る必要がある。\n*   parquet標準へのフォールバックは、データがすべて読み取り可能であることを意味する。\n*   DataFusionがこのメタデータの読み取り方法の仕様と、実装を検証するためのテストスイートを公開しているかどうかは不明。\n\n## Parquetファイル形式\n*   Parquetファイルには、FileMetadata構造にkey\\_value\\_metadataというフィールドが含まれている。\n*   記事で説明されている手法は、このキーと値のペアを使用して、ファイルに埋め込まれた追加のメタデータ（この場合は個別のインデックス）へのポインタを格納していると思われる。\n*   各データページ間のParquetファイルに任意のバイナリデータを埋め込むことができる。\n*   すべてのParquetリーダーはfooterで指定されたデータページへの正確なオフセットに依存しているため、これは完全に有効である。\n\n## まとめ\nDataFusionは、Parquetファイル形式の柔軟性を活用して、カスタムメタデータを追加し、クエリのパフォーマンスを向上させる方法を示した。この手法は他のエンジンでも使用できるが、メタデータの解釈方法を認識する必要がある。"
}